name: Ping Render & Azure Email Job

on:
  schedule:
    - cron: "*/5 * * * *"  # ch·∫°y m·ªói 5 ph√∫t
  workflow_dispatch:         # c√≥ th·ªÉ ch·∫°y th·ªß c√¥ng n·∫øu mu·ªën

jobs:
  ping:
    runs-on: ubuntu-latest

    steps:
      - name: Wake up Render app
        run: |
          echo "üü° Waking up Render app..."
          response=$(curl -s -o /dev/null -w "%{http_code}" https://podcast-shoppings.onrender.com)
          if [ "$response" -eq 200 ]; then
            echo "‚úÖ Render app responded successfully!"
          else
            echo "‚ö†Ô∏è Render app may still be sleeping (HTTP $response)"
          fi

      - name: Wait for Render to wake up
        run: |
          echo "‚è≥ Waiting for Render app to stabilize..."
          sleep 20

      - name: Trigger Azure email job
        run: |
          echo "üìß Triggering scheduled email job on Azure..."
          response=$(curl -s -o /dev/null -w "%{http_code}" https://healink-ewaybqg9encadbe8.southeastasia-01.azurewebsites.net/api/emails/run-email-job)
          if [ "$response" -eq 200 ]; then
            echo "‚úÖ Azure email job triggered successfully!"
          else
            echo "‚ùå Azure email job failed with HTTP code: $response"
          fi

      - name: Log timestamp
        run: |
          echo "üïí Job completed at $(date '+%Y-%m-%d %H:%M:%S')"
